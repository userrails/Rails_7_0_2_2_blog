(function(u,i){typeof exports=="object"&&typeof module!="undefined"?module.exports=i():typeof define=="function"&&define.amd?define(i):(u=typeof globalThis!="undefined"?globalThis:u||self,u["stimulus-rails-nested-form"]=i())})(this,function(){"use strict";function u(e){return e.replace(/(?:[_-])([a-z0-9])/g,(t,r)=>r.toUpperCase())}function i(e){return e.charAt(0).toUpperCase()+e.slice(1)}function m(e){return e.replace(/([A-Z])/g,(t,r)=>`-${r.toLowerCase()}`)}function d(e,t){const r=g(e);return Array.from(r.reduce((n,s)=>(T(s,t).forEach(o=>n.add(o)),n),new Set))}function j(e,t){return g(e).reduce((n,s)=>(n.push(...O(s,t)),n),[])}function g(e){const t=[];for(;e;)t.push(e),e=Object.getPrototypeOf(e);return t.reverse()}function T(e,t){const r=e[t];return Array.isArray(r)?r:[]}function O(e,t){const r=e[t];return r?Object.keys(r).map(n=>[n,r[n]]):[]}(()=>{function e(r){function n(){return Reflect.construct(r,arguments,new.target)}return n.prototype=Object.create(r.prototype,{constructor:{value:n}}),Reflect.setPrototypeOf(n,r),n}function t(){const n=e(function(){this.a.call(this)});return n.prototype.a=function(){},new n}try{return t(),e}catch(r){return n=>class extends n{}}})();function A(e){return d(e,"classes").reduce((r,n)=>Object.assign(r,$(n)),{})}function $(e){return{[`${e}Class`]:{get(){const{classes:t}=this;if(t.has(e))return t.get(e);{const r=t.getAttributeName(e);throw new Error(`Missing attribute "${r}"`)}}},[`${e}Classes`]:{get(){return this.classes.getAll(e)}},[`has${i(e)}Class`]:{get(){return this.classes.has(e)}}}}function v(e){return d(e,"targets").reduce((r,n)=>Object.assign(r,S(n)),{})}function S(e){return{[`${e}Target`]:{get(){const t=this.targets.find(e);if(t)return t;throw new Error(`Missing target element "${e}" for "${this.identifier}" controller`)}},[`${e}Targets`]:{get(){return this.targets.findAll(e)}},[`has${i(e)}Target`]:{get(){return this.targets.has(e)}}}}function V(e){const t=j(e,"values"),r={valueDescriptorMap:{get(){return t.reduce((n,s)=>{const o=h(s),a=this.data.getAttributeNameForKey(o.key);return Object.assign(n,{[a]:o})},{})}}};return t.reduce((n,s)=>Object.assign(n,C(s)),r)}function C(e){const t=h(e),{key:r,name:n,reader:s,writer:o}=t;return{[n]:{get(){const a=this.data.get(r);return a!==null?s(a):t.defaultValue},set(a){a===void 0?this.data.delete(r):this.data.set(r,o(a))}},[`has${i(n)}`]:{get(){return this.data.has(r)||t.hasCustomDefaultValue}}}}function h([e,t]){return F(e,t)}function l(e){switch(e){case Array:return"array";case Boolean:return"boolean";case Number:return"number";case Object:return"object";case String:return"string"}}function f(e){switch(typeof e){case"boolean":return"boolean";case"number":return"number";case"string":return"string"}if(Array.isArray(e))return"array";if(Object.prototype.toString.call(e)==="[object Object]")return"object"}function E(e){const t=l(e.type);if(t){const r=f(e.default);if(t!==r)throw new Error(`Type "${t}" must match the type of the default value. Given default value: "${e.default}" as "${r}"`);return t}}function D(e){const t=E(e),r=f(e),n=l(e),s=t||r||n;if(s)return s;throw new Error(`Unknown value type "${e}"`)}function x(e){const t=l(e);if(t)return P[t];const r=e.default;return r!==void 0?r:e}function F(e,t){const r=`${m(e)}-value`,n=D(t);return{type:n,key:r,name:u(r),get defaultValue(){return x(t)},get hasCustomDefaultValue(){return f(t)!==void 0},reader:N[n],writer:b[n]||b.default}}const P={get array(){return[]},boolean:!1,number:0,get object(){return{}},string:""},N={array(e){const t=JSON.parse(e);if(!Array.isArray(t))throw new TypeError("Expected array");return t},boolean(e){return!(e=="0"||e=="false")},number(e){return Number(e)},object(e){const t=JSON.parse(e);if(t===null||typeof t!="object"||Array.isArray(t))throw new TypeError("Expected object");return t},string(e){return e}},b={default:R,array:y,object:y};function y(e){return JSON.stringify(e)}function R(e){return`${e}`}class c{constructor(t){this.context=t}static get shouldLoad(){return!0}get application(){return this.context.application}get scope(){return this.context.scope}get element(){return this.scope.element}get identifier(){return this.scope.identifier}get targets(){return this.scope.targets}get classes(){return this.scope.classes}get data(){return this.scope.data}initialize(){}connect(){}disconnect(){}dispatch(t,{target:r=this.element,detail:n={},prefix:s=this.identifier,bubbles:o=!0,cancelable:a=!0}={}){const M=s?`${s}:${t}`:t,w=new CustomEvent(M,{detail:n,bubbles:o,cancelable:a});return r.dispatchEvent(w),w}}c.blessings=[A,v,V],c.targets=[],c.values={};class p extends c{add(t){t.preventDefault();const r=this.templateTarget.innerHTML.replace(/NEW_RECORD/g,new Date().getTime().toString());this.targetTarget.insertAdjacentHTML("beforebegin",r)}remove(t){t.preventDefault();const r=t.target.closest(this.wrapperSelectorValue);if(r.dataset.newRecord==="true")r.remove();else{r.style.display="none";const n=r.querySelector("input[name*='_destroy']");n.value="1"}}}return p.targets=["target","template"],p.values={wrapperSelector:{type:String,default:".nested-form-wrapper"}},p});
